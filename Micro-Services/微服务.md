## 微服务

> Micro-Services
>
> 参考：  https://www.cnblogs.com/jiangyu666/p/8522547.html

### 目录
* [是什么？](#是什么？)
* [落地存在的问题](#落地存在的问题)
* [组件分析](#组件分析)
* [Spring Cloud vs Service Mesh](#Spring-Cloud-vs-Service-Mesh)

### 是什么？
微服务倡导将复杂的单体应用拆分为若干个功能简单、松耦合的服务，这样可以降低开发难度、增强扩展性、便于敏捷开发。

微服务大多以集群的方式进行部署。

### 落地存在的问题

1. 单体应用拆分为分布式系统后，**进程间的通讯机制**和故障处理措施变的更加复杂。服务发现。

    解决方案： RPC框架 Dubbo，RESTful，注册中心Consul/Eureka/Zookeeper。

2. 系统微服务化后，一个看似简单的功能，内部可能需要调用多个服务并操作多个数据库实现，服务调用的**[分布式事务问题](分布式事务/分布式事务.md)**变的非常突出。

    解决方案： 阿里巴巴提出的分布式事务解决方案GTS，
    
3. 微服务数量众多，其**测试、部署、监控等**都变的更加困难。 集群的资源管理比较困难。

    解决方案： Docker
    
4. 微服务之间有着错综复杂的依赖关系，服务往往不是百分之百可靠，可能会出现错误或延迟。 那么就需要对可能出现的故障进行**容错和隔离**，否则就会应用可能被故障拖垮瘫痪。

    解决方案： [断路器](断路器.md)
    
5. 服务发现。

6. 负载均衡。

### 组件分析
* 前后端分离，数据解析，路由配置，数据分析，接口使用率，分布式集群节点监控，基于网关记录，任务调度
* 反向代理
    * Nginx反向代理
    * K8s反向代理负载均衡组件ingress
    * HAProxy反向代理
    * Apache(httpd)实现反向代理
* 服务注册与发行
    * Eureka
    * ZooKeeper
* 自动化部署
    * Jenkins  打包 自动发布 覆盖率检测，自动发布，自动重启，热部署
    * Docker
    * K8s
    * 平安PAFA
* 服务治理
    * Istio（调用链追踪、动态路由、熔断限流...）
    * zuul （路由网关，过滤拦截，鉴权）
* RPC： 短而轻 小而快 交互频繁
* 分布式事务管理： Agent代理模式，2PC（有性能瓶颈，暂时应该不影响），3PC
    * LCN方式， Spring Cloud 分布式事务管理。基于AOP的分布式事务管理方式， 注解， 支持2PC
    * Seata，支持2PC
    * 淘宝
    * 注： 考虑服务降级。如果服务是隔离的，考虑服务降级的兜底策略。 熔断器Hystrix 豪猪。
* 分布式锁
    * Redis客户端，Redis连Redis，计数，原子自增。
* 配置中心
    * Apollo 
* 分布式调用链
    * zipkin
    * PinPoint
    * skywalking
    * jaeger
    * CAT
* 日志
    * ELK 
* 负载均衡： 策略（轮训，加权，处理时间等）， 硬件负载，软件负载。
    * Spring Cloud Ribbon负载均衡策略。 不太好用。
* MQ： 性能，稳定性。 分布式事务3PC基本都基于消息中间件，快。
    * RocketMQ
    * Kafka
    * 微信MQ，点对点快。
* 数据库，多数据源
    * InfluxDB
    * Redis
    * MongoDB
    * MySQL。 动态扩容，分表，MyCat，
    * Oracle
* 运行环境，逻辑上CPU，基于物理机分虚拟机。
* Spring Cloud
    * Spring cloud bus数据总线

### Spring Cloud vs Service Mesh

微服务技术，以Spring Cloud为代表的传统侵入式开发框架，占据着微服务市场的主流地位，甚至一度成为微服务的代名词。

2017年底，非侵入式Service Mesh技术逐渐走向成熟，Istio和Conduit出现。

